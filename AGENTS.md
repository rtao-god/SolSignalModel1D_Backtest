# AGENTS

## Язык и стиль
- Всё (ответы, сообщения, комментарии в коде) — только на русском, но throw в коде на английском пиши. 
- Пиши технически и по делу, без лишних пояснений и «воды».

## Правдивость (обязательно)
- Явно помечай: **Факты / Предположения / Гипотезы**.
- Не выдумывай контекст/контракты/пути/имена. Если что-то не проверял (сборка/тесты/рантайм) — так и напиши.

## Скоуп и совместимость
- Делай только то, что я попросил. Без «попутных улучшений», но если видишь места, где можно что-либо улучшить — скажи.
- По умолчанию: **не менять** архитектуру, публичные типы, сигнатуры, формат/колонки/структуру вывода, поведение — если я явно не попросил или этого не требует задача.
- Минимальный дифф: сохраняй стиль/структуру/нейминг/порядок, не трогай соседний код без необходимости.

## Ошибки и fail-fast
- Никаких «тихих» дефолтов/заглушек.
- Невозможные/анормальные состояния — делаем всегда **throw**
- В exception/ошибке указывай ключевой контекст и подробности (entryUtc/day-key/tag/counts и т.п.).

## Файлы / перемещения / рефактор
- Не создавай новые файлы и не перемещай существующие без явного запроса.
- Если без этого нельзя — сначала объясни причину и перечисли, что именно будет создано/перемещено.
- Если пришлось делать переименования/миграцию — дай таблицу:
  - устаревшее → замена → где обновлено (файлы/символы)
  - без «полу-миграций».

## Контекст и навигация
- Сначала ищи по репозиторию (rg / Go to Definition), не гадай.
- Вопросы задавай только если без них нельзя корректно продолжать.

## Инварианты домена (критично)
- Строго соблюдай границу: **causal ≠ omniscient**.
- Не допускай утечек будущего через данные/типы/зависимости/время.
- Если правка затрагивает эту границу — явно отметь риск в отчёте.

## Режим «идеальная архитектура»
- Включается только если я явно пишу: **«ид арх»**.
- Тогда разрешены ломающие изменения ради строгой типобезопасности и принципа
  «некорректные состояния непредставимы», миграция НЕ постепенная.
- Если не хватает критичного контекста — стоп и конкретный запрос (без «костылей ради компиляции»).
- Я хочу «идеальную архитектуру» в смысле физического барьера зависимостей, а не только дисциплины в коде. В том числе чёткое разделение на Core/Causal/* и Core.Omniscient.*

## Формат ответа (обязательно)
1) **Пути изменённых файлов** (точные).
2) По каждому файлу: 1–3 строки «что и зачем».
3) 2–6 ключевых diff-фрагментов **до/после** только для важного.
4) В конце всегда подводи сводку что мы сделали вообще по задаче, какая логика стала неактуальной и что на что мы вообще меняли и зачем. 
5) Если ты что-то из полученного тз не сделала - так и скажи, чтобы я сразу понимал, какие пункты выполнены, а какие нет.

## Commands (for Codex)
- См. `.codex/COMMON_COMMANDS.md`.

## Быстрые ориентиры по владельцам контрактов
- NY-окна / baseline-exit / DST / weekend-eligibility: `NyWindowing` (`SolSignalModel1D_Backtest.Core.Time`).
- Train/OOS split по baseline-exit day-key: `NyTrainSplit` / `SplitByBaselineExitStrict(...)` (файл встречался как `NyTrainSplit.Strict.cs`).
- Daily dataset: `DailyDatasetBuilder.Build(...)` (`SolSignalModel1D_Backtest.Core.Causal.ML.Daily`).
- Gap scan: `BinanceKlinesGapScanner.ScanGapsAsync(...)` (`SolSignalModel1D_Backtest.Core.Data.Candles.Diagnostics`).
- Индикаторы + coverage: `IndicatorsDailyUpdater.UpdateAllAsync(...)` / `EnsureCoverageOrFail(...)`.

## Доп. контекст проекта (прочитай при старте задачи)
- `.codex/ARCH_GUARDS.md` — инварианты (время, сплиты, каузальность, логирование).
- `.codex/PROJECT_OVERVIEW.md` — обзор и границы домена.
- `.codex/PROJECT_MAP.md` — карта репозитория и стартовые точки поиска.
- `.codex/COMMON_COMMANDS.md` — build/test/rg и типовой цикл фикса.
- `.codex/AGENT_BEHAVIOR.md` — правила работы агента (дефолты/комментарии/доведение до конца).


## Опциональные playbooks (открывать только если задача в этой зоне)
- `.codex/PLAYBOOKS/Time.NyWindowing.md`
- `.codex/PLAYBOOKS/Data.Candles.Gaps.md`
- `.codex/PLAYBOOKS/Data.Indicators.Coverage.md`
- `.codex/PLAYBOOKS/Debug.TrainSplitMismatch.md`
- `.codex/PLAYBOOKS/Data.RuntimePipeline.md`
